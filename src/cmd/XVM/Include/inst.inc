#ifndef US_INST
#define US_INST

#include "xvm.inc"
#include "mem.inc"

////////////////////////////////////////////////////////

struct InstInfo
{
	uint8_t *oplist;
	uint8_t len;
	bool hasImm;
	uint8_t immLen;
};

////////////////////////////////////////////////////////

class Inst
{
	private:
		std::map<std::vector<uint8_t>, InstInfo> instTable;
		MEM *mem;

		bool addInst(const std::vector<uint8_t> &opcode, uint8_t len, bool hasImm, uint8_t immLen)
		{
			InstInfo info;

			info.oplist = new uint8_t[len];
			for(uint8_t i = 0; i < len; i++) info.oplist[i] = opcode[i];

			info.len = len;
			info.hasImm = hasImm;
			info.immLen = immLen;
			instTable[opcode] = info;

			return true;
		}

	public:
		bool initTable(MEM *memP)
		{
			mem = memP;

			// NOP
			addInst({0x00}, 1, false, 0);

			// INC系
			addInst({0x01, 0x00, 0x00}, 3, false, 0);
			addInst({0x01, 0x00, 0x01}, 3, false, 0);
			addInst({0x01, 0x00, 0x02}, 3, false, 0);
			addInst({0x01, 0x00, 0x03}, 3, false, 0);
			addInst({0x01, 0x00, 0x04}, 3, false, 0);
			addInst({0x01, 0x00, 0x05}, 3, false, 0);
			addInst({0x01, 0x00, 0x06}, 3, false, 0);

			// ADD系
			// ADD EAX, ...
			addInst({0x01, 0x01, 0x00, 0x00}, 4, true, 4);
			addInst({0x01, 0x01, 0x00, 0x01}, 4, false, 0);
			addInst({0x01, 0x01, 0x00, 0x02}, 4, false, 0);
			addInst({0x01, 0x01, 0x00, 0x03}, 4, false, 0);
			addInst({0x01, 0x01, 0x00, 0x04}, 4, false, 0);

			// ADD EBX, ...
			addInst({0x01, 0x01, 0x01, 0x00}, 4, true, 4);
			addInst({0x01, 0x01, 0x01, 0x01}, 4, false, 0);
			addInst({0x01, 0x01, 0x01, 0x02}, 4, false, 0);
			addInst({0x01, 0x01, 0x01, 0x03}, 4, false, 0);
			addInst({0x01, 0x01, 0x01, 0x04}, 4, false, 0);
			addInst({0x01, 0x01, 0x01, 0x05}, 4, true, 4);
			addInst({0x01, 0x01, 0x01, 0x06}, 4, false, 0);
			addInst({0x01, 0x01, 0x01, 0x07}, 4, false, 0);
			addInst({0x01, 0x01, 0x01, 0x08}, 4, false, 0);
			addInst({0x01, 0x01, 0x01, 0x09}, 4, false, 0);

			// ADD ECX, ...
			addInst({0x01, 0x01, 0x02, 0x00}, 4, true, 4);
			addInst({0x01, 0x01, 0x02, 0x01}, 4, false, 0);
			addInst({0x01, 0x01, 0x02, 0x02}, 4, false, 0);
			addInst({0x01, 0x01, 0x02, 0x03}, 4, false, 0);
			addInst({0x01, 0x01, 0x02, 0x04}, 4, false, 0);

			// ADD EDX, ...
			addInst({0x01, 0x01, 0x03, 0x00}, 4, true, 4);
			addInst({0x01, 0x01, 0x03, 0x01}, 4, false, 0);
			addInst({0x01, 0x01, 0x03, 0x02}, 4, false, 0);
			addInst({0x01, 0x01, 0x03, 0x03}, 4, false, 0);
			addInst({0x01, 0x01, 0x03, 0x04}, 4, false, 0);

			// ADD EEX, ...
			addInst({0x01, 0x01, 0x04, 0x00}, 4, true, 4);
			addInst({0x01, 0x01, 0x04, 0x01}, 4, false, 0);
			addInst({0x01, 0x01, 0x04, 0x02}, 4, false, 0);
			addInst({0x01, 0x01, 0x04, 0x03}, 4, false, 0);
			addInst({0x01, 0x01, 0x04, 0x04}, 4, false, 0);

			// DEC系
			addInst({0x02, 0x00, 0x00}, 3, false, 0);
			addInst({0x02, 0x00, 0x01}, 3, false, 0);
			addInst({0x02, 0x00, 0x02}, 3, false, 0);
			addInst({0x02, 0x00, 0x03}, 3, false, 0);
			addInst({0x02, 0x00, 0x04}, 3, false, 0);
			addInst({0x02, 0x00, 0x05}, 3, false, 0);
			addInst({0x02, 0x00, 0x06}, 3, false, 0);

			// SUB系
			// SUB EAX, ...
			addInst({0x02, 0x01, 0x00, 0x00}, 4, true, 4);
			addInst({0x02, 0x01, 0x00, 0x01}, 4, false, 0);
			addInst({0x02, 0x01, 0x00, 0x02}, 4, false, 0);
			addInst({0x02, 0x01, 0x00, 0x03}, 4, false, 0);
			addInst({0x02, 0x01, 0x00, 0x04}, 4, false, 0);

			// SUB EBX, ...
			addInst({0x02, 0x01, 0x01, 0x00}, 4, true, 4);
			addInst({0x02, 0x01, 0x01, 0x01}, 4, false, 0);
			addInst({0x02, 0x01, 0x01, 0x02}, 4, false, 0);
			addInst({0x02, 0x01, 0x01, 0x03}, 4, false, 0);
			addInst({0x02, 0x01, 0x01, 0x04}, 4, false, 0);
			addInst({0x02, 0x01, 0x01, 0x05}, 4, true, 4);
			addInst({0x02, 0x01, 0x01, 0x06}, 4, false, 0);
			addInst({0x02, 0x01, 0x01, 0x07}, 4, false, 0);
			addInst({0x02, 0x01, 0x01, 0x08}, 4, false, 0);
			addInst({0x02, 0x01, 0x01, 0x09}, 4, false, 0);

			// SUB ECX, ...
			addInst({0x02, 0x02, 0x01, 0x00}, 4, true, 4);
			addInst({0x02, 0x02, 0x01, 0x01}, 4, false, 0);
			addInst({0x02, 0x02, 0x01, 0x02}, 4, false, 0);
			addInst({0x02, 0x02, 0x01, 0x03}, 4, false, 0);
			addInst({0x02, 0x02, 0x01, 0x04}, 4, false, 0);

			// SUB EDX, ...
			addInst({0x02, 0x03, 0x01, 0x00}, 4, true, 4);
			addInst({0x02, 0x03, 0x01, 0x01}, 4, false, 0);
			addInst({0x02, 0x03, 0x01, 0x02}, 4, false, 0);
			addInst({0x02, 0x03, 0x01, 0x03}, 4, false, 0);
			addInst({0x02, 0x03, 0x01, 0x04}, 4, false, 0);

			// SUB EEX, ...
			addInst({0x02, 0x04, 0x01, 0x00}, 4, true, 4);
			addInst({0x02, 0x04, 0x01, 0x01}, 4, false, 0);
			addInst({0x02, 0x04, 0x01, 0x02}, 4, false, 0);
			addInst({0x02, 0x04, 0x01, 0x03}, 4, false, 0);
			addInst({0x02, 0x04, 0x01, 0x04}, 4, false, 0);

			// LD系
			// LD EAX, ...
			addInst({0x03, 0x00, 0x00}, 3, true, 4);
			addInst({0x03, 0x00, 0x01}, 3, false, 0);
			addInst({0x03, 0x00, 0x02}, 3, false, 0);
			addInst({0x03, 0x00, 0x03}, 3, false, 0);
			addInst({0x03, 0x00, 0x04}, 3, false, 0);
			addInst({0x03, 0x00, 0x05}, 3, true, 4);
			addInst({0x03, 0x00, 0x06}, 3, false, 0);
			addInst({0x03, 0x00, 0x07}, 3, false, 0);
			addInst({0x03, 0x00, 0x08}, 3, false, 0);
			addInst({0x03, 0x00, 0x09}, 3, false, 0);
			addInst({0x03, 0x00, 0x0A}, 3, true, 4);
			addInst({0x03, 0x00, 0x0B}, 3, false, 0);
			addInst({0x03, 0x00, 0x0C}, 3, false, 0);
			addInst({0x03, 0x00, 0x0D}, 3, false, 0);
			addInst({0x03, 0x00, 0x0E}, 3, false, 0);
			addInst({0x03, 0x00, 0x0F}, 3, false, 0);
			addInst({0x03, 0x00, 0x10}, 3, false, 0);

			// LD EBX, ...
			addInst({0x03, 0x01, 0x00}, 3, true, 4);
			addInst({0x03, 0x01, 0x01}, 3, false, 0);
			addInst({0x03, 0x01, 0x02}, 3, false, 0);
			addInst({0x03, 0x01, 0x03}, 3, false, 0);
			addInst({0x03, 0x01, 0x04}, 3, false, 0);
			addInst({0x03, 0x01, 0x05}, 3, true, 4);
			addInst({0x03, 0x01, 0x06}, 3, false, 0);
			addInst({0x03, 0x01, 0x07}, 3, false, 0);
			addInst({0x03, 0x01, 0x08}, 3, false, 0);
			addInst({0x03, 0x01, 0x09}, 3, true, 4);
			addInst({0x03, 0x01, 0x0A}, 3, false, 0);
			addInst({0x03, 0x01, 0x0B}, 3, false, 0);
			addInst({0x03, 0x01, 0x0C}, 3, false, 0);
			addInst({0x03, 0x01, 0x0D}, 3, false, 0);
			addInst({0x03, 0x01, 0x0E}, 3, false, 0);
			addInst({0x03, 0x01, 0x0F}, 3, false, 0);
			addInst({0x03, 0x01, 0x10}, 3, false, 0);

			// LD ECX, ...
			addInst({0x03, 0x02, 0x00}, 3, true, 4);
			addInst({0x03, 0x02, 0x01}, 3, false, 0);
			addInst({0x03, 0x02, 0x02}, 3, false, 0);
			addInst({0x03, 0x02, 0x03}, 3, false, 0);
			addInst({0x03, 0x02, 0x04}, 3, false, 0);

			// LD EDX, ...
			addInst({0x03, 0x03, 0x00}, 3, true, 4);
			addInst({0x03, 0x03, 0x01}, 3, false, 0);
			addInst({0x03, 0x03, 0x02}, 3, false, 0);
			addInst({0x03, 0x03, 0x03}, 3, false, 0);
			addInst({0x03, 0x03, 0x04}, 3, false, 0);

			// LD EEX, ...
			addInst({0x03, 0x04, 0x00}, 3, true, 4);
			addInst({0x03, 0x04, 0x01}, 3, false, 0);
			addInst({0x03, 0x04, 0x02}, 3, false, 0);
			addInst({0x03, 0x04, 0x03}, 3, false, 0);
			addInst({0x03, 0x04, 0x04}, 3, false, 0);

			// LD EDI, ...
			addInst({0x03, 0x05, 0x00}, 3, true, 4);
			addInst({0x03, 0x05, 0x01}, 3, false, 0);
			addInst({0x03, 0x05, 0x02}, 3, false, 0);
			addInst({0x03, 0x05, 0x03}, 3, false, 0);
			addInst({0x03, 0x05, 0x04}, 3, false, 0);
			addInst({0x03, 0x05, 0x05}, 3, false, 0);
			addInst({0x03, 0x05, 0x06}, 3, true, 4);
			addInst({0x03, 0x05, 0x07}, 3, false, 0);
			addInst({0x03, 0x05, 0x08}, 3, false, 0);
			addInst({0x03, 0x05, 0x09}, 3, false, 0);
			addInst({0x03, 0x05, 0x0A}, 3, true, 4);
			addInst({0x03, 0x05, 0x0B}, 3, false, 0);
			addInst({0x03, 0x05, 0x0C}, 3, false, 0);
			addInst({0x03, 0x05, 0x0D}, 3, false, 0);

			// LD ESI, ...
			addInst({0x03, 0x06, 0x00}, 3, true, 4);
			addInst({0x03, 0x06, 0x01}, 3, false, 0);
			addInst({0x03, 0x06, 0x02}, 3, false, 0);
			addInst({0x03, 0x06, 0x03}, 3, false, 0);
			addInst({0x03, 0x06, 0x04}, 3, false, 0);
			addInst({0x03, 0x06, 0x05}, 3, false, 0);
			addInst({0x03, 0x06, 0x06}, 3, true, 4);
			addInst({0x03, 0x06, 0x07}, 3, false, 0);
			addInst({0x03, 0x06, 0x08}, 3, false, 0);
			addInst({0x03, 0x06, 0x09}, 3, false, 0);
			addInst({0x03, 0x06, 0x0A}, 3, true, 4);
			addInst({0x03, 0x06, 0x0B}, 3, false, 0);
			addInst({0x03, 0x06, 0x0C}, 3, false, 0);
			addInst({0x03, 0x06, 0x0D}, 3, false, 0);

			// LD EBP, ...
			addInst({0x03, 0x07, 0x00}, 3, true, 4);
			addInst({0x03, 0x07, 0x01}, 3, false, 0);
			addInst({0x03, 0x07, 0x02}, 3, false, 0);
			addInst({0x03, 0x07, 0x03}, 3, false, 0);
			addInst({0x03, 0x07, 0x04}, 3, false, 0);
			addInst({0x03, 0x07, 0x05}, 3, false, 0);
			addInst({0x03, 0x07, 0x06}, 3, true, 4);
			addInst({0x03, 0x07, 0x07}, 3, false, 0);
			addInst({0x03, 0x07, 0x08}, 3, false, 0);
			addInst({0x03, 0x07, 0x09}, 3, false, 0);
			addInst({0x03, 0x07, 0x0A}, 3, true, 4);
			addInst({0x03, 0x07, 0x0B}, 3, false, 0);
			addInst({0x03, 0x07, 0x0C}, 3, false, 0);

			// OR系
			// OR EAX, ...
			addInst({0x04, 0x00, 0x00}, 3, true, 4);
			addInst({0x04, 0x00, 0x01}, 3, false, 0);
			addInst({0x04, 0x00, 0x02}, 3, false, 0);
			addInst({0x04, 0x00, 0x03}, 3, false, 0);
			addInst({0x04, 0x00, 0x04}, 3, false, 0);

			// OR EBX, ...
			addInst({0x04, 0x01, 0x00}, 3, true, 4);
			addInst({0x04, 0x01, 0x01}, 3, false, 0);
			addInst({0x04, 0x01, 0x02}, 3, false, 0);
			addInst({0x04, 0x01, 0x03}, 3, false, 0);
			addInst({0x04, 0x01, 0x04}, 3, false, 0);
			addInst({0x04, 0x01, 0x05}, 3, true, 4);
			addInst({0x04, 0x01, 0x06}, 3, false, 0);
			addInst({0x04, 0x01, 0x07}, 3, false, 0);
			addInst({0x04, 0x01, 0x08}, 3, false, 0);
			addInst({0x04, 0x01, 0x09}, 3, false, 0);

			// OR ECX, ...
			addInst({0x04, 0x02, 0x00}, 3, true, 4);
			addInst({0x04, 0x02, 0x01}, 3, false, 0);
			addInst({0x04, 0x02, 0x02}, 3, false, 0);
			addInst({0x04, 0x02, 0x03}, 3, false, 0);
			addInst({0x04, 0x02, 0x04}, 3, false, 0);

			// OR EDX, ...
			addInst({0x04, 0x03, 0x00}, 3, true, 4);
			addInst({0x04, 0x03, 0x01}, 3, false, 0);
			addInst({0x04, 0x03, 0x02}, 3, false, 0);
			addInst({0x04, 0x03, 0x03}, 3, false, 0);
			addInst({0x04, 0x03, 0x04}, 3, false, 0);

			// OR EEX, ...
			addInst({0x04, 0x04, 0x00}, 3, true, 4);
			addInst({0x04, 0x04, 0x01}, 3, false, 0);
			addInst({0x04, 0x04, 0x02}, 3, false, 0);
			addInst({0x04, 0x04, 0x03}, 3, false, 0);
			addInst({0x04, 0x04, 0x04}, 3, false, 0);

			// AND系
			// AND EAX, ...
			addInst({0x05, 0x00, 0x00}, 3, true, 4);
			addInst({0x05, 0x00, 0x01}, 3, false, 0);
			addInst({0x05, 0x00, 0x02}, 3, false, 0);
			addInst({0x05, 0x00, 0x03}, 3, false, 0);
			addInst({0x05, 0x00, 0x04}, 3, false, 0);

			// AND EBX, ...
			addInst({0x05, 0x01, 0x00}, 3, true, 4);
			addInst({0x05, 0x01, 0x01}, 3, false, 0);
			addInst({0x05, 0x01, 0x02}, 3, false, 0);
			addInst({0x05, 0x01, 0x03}, 3, false, 0);
			addInst({0x05, 0x01, 0x04}, 3, false, 0);
			addInst({0x05, 0x01, 0x05}, 3, true, 4);
			addInst({0x05, 0x01, 0x06}, 3, false, 0);
			addInst({0x05, 0x01, 0x07}, 3, false, 0);
			addInst({0x05, 0x01, 0x08}, 3, false, 0);
			addInst({0x05, 0x01, 0x09}, 3, false, 0);

			// AND ECX, ...
			addInst({0x05, 0x02, 0x00}, 3, true, 4);
			addInst({0x05, 0x02, 0x01}, 3, false, 0);
			addInst({0x05, 0x02, 0x02}, 3, false, 0);
			addInst({0x05, 0x02, 0x03}, 3, false, 0);
			addInst({0x05, 0x02, 0x04}, 3, false, 0);

			// AND EDX, ...
			addInst({0x05, 0x03, 0x00}, 3, true, 4);
			addInst({0x05, 0x03, 0x01}, 3, false, 0);
			addInst({0x05, 0x03, 0x02}, 3, false, 0);
			addInst({0x05, 0x03, 0x03}, 3, false, 0);
			addInst({0x05, 0x03, 0x04}, 3, false, 0);

			// AND EEX, ...
			addInst({0x05, 0x04, 0x00}, 3, true, 4);
			addInst({0x05, 0x04, 0x01}, 3, false, 0);
			addInst({0x05, 0x04, 0x02}, 3, false, 0);
			addInst({0x05, 0x04, 0x03}, 3, false, 0);
			addInst({0x05, 0x04, 0x04}, 3, false, 0);

			// XOR系
			// XOR EAX, ...
			addInst({0x06, 0x00, 0x00}, 3, true, 4);
			addInst({0x06, 0x00, 0x01}, 3, false, 0);
			addInst({0x06, 0x00, 0x02}, 3, false, 0);
			addInst({0x06, 0x00, 0x03}, 3, false, 0);
			addInst({0x06, 0x00, 0x04}, 3, false, 0);

			// XOR EBX, ...
			addInst({0x06, 0x01, 0x00}, 3, true, 4);
			addInst({0x06, 0x01, 0x01}, 3, false, 0);
			addInst({0x06, 0x01, 0x02}, 3, false, 0);
			addInst({0x06, 0x01, 0x03}, 3, false, 0);
			addInst({0x06, 0x01, 0x04}, 3, false, 0);
			addInst({0x06, 0x01, 0x05}, 3, true, 4);
			addInst({0x06, 0x01, 0x06}, 3, false, 0);
			addInst({0x06, 0x01, 0x07}, 3, false, 0);
			addInst({0x06, 0x01, 0x08}, 3, false, 0);
			addInst({0x06, 0x01, 0x09}, 3, false, 0);

			// XOR ECX, ...
			addInst({0x06, 0x02, 0x00}, 3, true, 4);
			addInst({0x06, 0x02, 0x01}, 3, false, 0);
			addInst({0x06, 0x02, 0x02}, 3, false, 0);
			addInst({0x06, 0x02, 0x03}, 3, false, 0);
			addInst({0x06, 0x02, 0x04}, 3, false, 0);

			// XOR EDX, ...
			addInst({0x06, 0x03, 0x00}, 3, true, 4);
			addInst({0x06, 0x03, 0x01}, 3, false, 0);
			addInst({0x06, 0x03, 0x02}, 3, false, 0);
			addInst({0x06, 0x03, 0x03}, 3, false, 0);
			addInst({0x06, 0x03, 0x04}, 3, false, 0);

			// XOR EEX, ...
			addInst({0x06, 0x04, 0x00}, 3, true, 4);
			addInst({0x06, 0x04, 0x01}, 3, false, 0);
			addInst({0x06, 0x04, 0x02}, 3, false, 0);
			addInst({0x06, 0x04, 0x03}, 3, false, 0);
			addInst({0x06, 0x04, 0x04}, 3, false, 0);

			// NOT系
			addInst({0x07, 0x00}, 2, false, 0);
			addInst({0x07, 0x01}, 2, false, 0);
			addInst({0x07, 0x02}, 2, false, 0);
			addInst({0x07, 0x03}, 2, false, 0);
			addInst({0x07, 0x04}, 2, false, 0);

			// LST系
			// LST EAX, ...
			addInst({0x08, 0x00, 0x00, 0x00}, 4, true, 4);
			addInst({0x08, 0x00, 0x00, 0x01}, 4, false, 0);
			addInst({0x08, 0x00, 0x00, 0x02}, 4, false, 0);
			addInst({0x08, 0x00, 0x00, 0x03}, 4, false, 0);
			addInst({0x08, 0x00, 0x00, 0x04}, 4, false, 0);

			// LST EBX, ...
			addInst({0x08, 0x00, 0x01, 0x00}, 4, true, 4);
			addInst({0x08, 0x00, 0x01, 0x01}, 4, false, 0);
			addInst({0x08, 0x00, 0x01, 0x02}, 4, false, 0);
			addInst({0x08, 0x00, 0x01, 0x03}, 4, false, 0);
			addInst({0x08, 0x00, 0x01, 0x04}, 4, false, 0);
			addInst({0x08, 0x00, 0x01, 0x05}, 4, true, 4);
			addInst({0x08, 0x00, 0x01, 0x06}, 4, false, 0);
			addInst({0x08, 0x00, 0x01, 0x07}, 4, false, 0);
			addInst({0x08, 0x00, 0x01, 0x08}, 4, false, 0);
			addInst({0x08, 0x00, 0x01, 0x09}, 4, false, 0);

			// LST ECX, ...
			addInst({0x08, 0x00, 0x02, 0x00}, 4, true, 4);
			addInst({0x08, 0x00, 0x02, 0x01}, 4, false, 0);
			addInst({0x08, 0x00, 0x02, 0x02}, 4, false, 0);
			addInst({0x08, 0x00, 0x02, 0x03}, 4, false, 0);
			addInst({0x08, 0x00, 0x02, 0x04}, 4, false, 0);

			// LST EDX, ...
			addInst({0x08, 0x00, 0x03, 0x00}, 4, true, 4);
			addInst({0x08, 0x00, 0x03, 0x01}, 4, false, 0);
			addInst({0x08, 0x00, 0x03, 0x02}, 4, false, 0);
			addInst({0x08, 0x00, 0x03, 0x03}, 4, false, 0);
			addInst({0x08, 0x00, 0x03, 0x04}, 4, false, 0);

			// LST EEX, ...
			addInst({0x08, 0x00, 0x04, 0x00}, 4, true, 4);
			addInst({0x08, 0x00, 0x04, 0x01}, 4, false, 0);
			addInst({0x08, 0x00, 0x04, 0x02}, 4, false, 0);
			addInst({0x08, 0x00, 0x04, 0x03}, 4, false, 0);
			addInst({0x08, 0x00, 0x04, 0x04}, 4, false, 0);

			// RST系
			// RST EAX, ...
			addInst({0x08, 0x01, 0x00, 0x00}, 4, true, 4);
			addInst({0x08, 0x01, 0x00, 0x01}, 4, false, 0);
			addInst({0x08, 0x01, 0x00, 0x02}, 4, false, 0);
			addInst({0x08, 0x01, 0x00, 0x03}, 4, false, 0);
			addInst({0x08, 0x01, 0x00, 0x04}, 4, false, 0);

			// RST EBX, ...
			addInst({0x08, 0x01, 0x01, 0x00}, 4, true, 4);
			addInst({0x08, 0x01, 0x01, 0x01}, 4, false, 0);
			addInst({0x08, 0x01, 0x01, 0x02}, 4, false, 0);
			addInst({0x08, 0x01, 0x01, 0x03}, 4, false, 0);
			addInst({0x08, 0x01, 0x01, 0x04}, 4, false, 0);
			addInst({0x08, 0x01, 0x01, 0x05}, 4, true, 4);
			addInst({0x08, 0x01, 0x01, 0x06}, 4, false, 0);
			addInst({0x08, 0x01, 0x01, 0x07}, 4, false, 0);
			addInst({0x08, 0x01, 0x01, 0x08}, 4, false, 0);
			addInst({0x08, 0x01, 0x01, 0x09}, 4, false, 0);

			// RST ECX, ...
			addInst({0x08, 0x01, 0x02, 0x00}, 4, true, 4);
			addInst({0x08, 0x01, 0x02, 0x01}, 4, false, 0);
			addInst({0x08, 0x01, 0x02, 0x02}, 4, false, 0);
			addInst({0x08, 0x01, 0x02, 0x03}, 4, false, 0);
			addInst({0x08, 0x01, 0x02, 0x04}, 4, false, 0);

			// RST EDX, ...
			addInst({0x08, 0x01, 0x03, 0x00}, 4, true, 4);
			addInst({0x08, 0x01, 0x03, 0x01}, 4, false, 0);
			addInst({0x08, 0x01, 0x03, 0x02}, 4, false, 0);
			addInst({0x08, 0x01, 0x03, 0x03}, 4, false, 0);
			addInst({0x08, 0x01, 0x03, 0x04}, 4, false, 0);

			// RST EEX, ...
			addInst({0x08, 0x01, 0x04, 0x00}, 4, true, 4);
			addInst({0x08, 0x01, 0x04, 0x01}, 4, false, 0);
			addInst({0x08, 0x01, 0x04, 0x02}, 4, false, 0);
			addInst({0x08, 0x01, 0x04, 0x03}, 4, false, 0);
			addInst({0x08, 0x01, 0x04, 0x04}, 4, false, 0);

			// LLT系
			// LLT EAX, ...
			addInst({0x09, 0x00, 0x00, 0x00}, 4, true, 4);
			addInst({0x09, 0x00, 0x00, 0x01}, 4, false, 0);
			addInst({0x09, 0x00, 0x00, 0x02}, 4, false, 0);
			addInst({0x09, 0x00, 0x00, 0x03}, 4, false, 0);
			addInst({0x09, 0x00, 0x00, 0x04}, 4, false, 0);

			// LLT EBX, ...
			addInst({0x09, 0x00, 0x01, 0x00}, 4, true, 4);
			addInst({0x09, 0x00, 0x01, 0x01}, 4, false, 0);
			addInst({0x09, 0x00, 0x01, 0x02}, 4, false, 0);
			addInst({0x09, 0x00, 0x01, 0x03}, 4, false, 0);
			addInst({0x09, 0x00, 0x01, 0x04}, 4, false, 0);
			addInst({0x09, 0x00, 0x01, 0x05}, 4, true, 4);
			addInst({0x09, 0x00, 0x01, 0x06}, 4, false, 0);
			addInst({0x09, 0x00, 0x01, 0x07}, 4, false, 0);
			addInst({0x09, 0x00, 0x01, 0x08}, 4, false, 0);
			addInst({0x09, 0x00, 0x01, 0x09}, 4, false, 0);

			// LLT ECX, ...
			addInst({0x09, 0x00, 0x02, 0x00}, 4, true, 4);
			addInst({0x09, 0x00, 0x02, 0x01}, 4, false, 0);
			addInst({0x09, 0x00, 0x02, 0x02}, 4, false, 0);
			addInst({0x09, 0x00, 0x02, 0x03}, 4, false, 0);
			addInst({0x09, 0x00, 0x02, 0x04}, 4, false, 0);

			// LLT EDX, ...
			addInst({0x09, 0x00, 0x03, 0x00}, 4, true, 4);
			addInst({0x09, 0x00, 0x03, 0x01}, 4, false, 0);
			addInst({0x09, 0x00, 0x03, 0x02}, 4, false, 0);
			addInst({0x09, 0x00, 0x03, 0x03}, 4, false, 0);
			addInst({0x09, 0x00, 0x03, 0x04}, 4, false, 0);

			// LLT EEX, ...
			addInst({0x09, 0x00, 0x04, 0x00}, 4, true, 4);
			addInst({0x09, 0x00, 0x04, 0x01}, 4, false, 0);
			addInst({0x09, 0x00, 0x04, 0x02}, 4, false, 0);
			addInst({0x09, 0x00, 0x04, 0x03}, 4, false, 0);
			addInst({0x09, 0x00, 0x04, 0x04}, 4, false, 0);

			// RLT系
			// RLT EAX, ...
			addInst({0x09, 0x01, 0x00, 0x00}, 4, true, 4);
			addInst({0x09, 0x01, 0x00, 0x01}, 4, false, 0);
			addInst({0x09, 0x01, 0x00, 0x02}, 4, false, 0);
			addInst({0x09, 0x01, 0x00, 0x03}, 4, false, 0);
			addInst({0x09, 0x01, 0x00, 0x04}, 4, false, 0);

			// RLT EBX, ...
			addInst({0x09, 0x01, 0x01, 0x00}, 4, true, 4);
			addInst({0x09, 0x01, 0x01, 0x01}, 4, false, 0);
			addInst({0x09, 0x01, 0x01, 0x02}, 4, false, 0);
			addInst({0x09, 0x01, 0x01, 0x03}, 4, false, 0);
			addInst({0x09, 0x01, 0x01, 0x04}, 4, false, 0);
			addInst({0x09, 0x01, 0x01, 0x05}, 4, true, 4);
			addInst({0x09, 0x01, 0x01, 0x06}, 4, false, 0);
			addInst({0x09, 0x01, 0x01, 0x07}, 4, false, 0);
			addInst({0x09, 0x01, 0x01, 0x08}, 4, false, 0);
			addInst({0x09, 0x01, 0x01, 0x09}, 4, false, 0);

			// RLT ECX, ...
			addInst({0x09, 0x01, 0x02, 0x00}, 4, true, 4);
			addInst({0x09, 0x01, 0x02, 0x01}, 4, false, 0);
			addInst({0x09, 0x01, 0x02, 0x02}, 4, false, 0);
			addInst({0x09, 0x01, 0x02, 0x03}, 4, false, 0);
			addInst({0x09, 0x01, 0x02, 0x04}, 4, false, 0);

			// RLT EDX, ...
			addInst({0x09, 0x01, 0x03, 0x00}, 4, true, 4);
			addInst({0x09, 0x01, 0x03, 0x01}, 4, false, 0);
			addInst({0x09, 0x01, 0x03, 0x02}, 4, false, 0);
			addInst({0x09, 0x01, 0x03, 0x03}, 4, false, 0);
			addInst({0x09, 0x01, 0x03, 0x04}, 4, false, 0);

			// RLT EEX, ...
			addInst({0x09, 0x01, 0x04, 0x00}, 4, true, 4);
			addInst({0x09, 0x01, 0x04, 0x01}, 4, false, 0);
			addInst({0x09, 0x01, 0x04, 0x02}, 4, false, 0);
			addInst({0x09, 0x01, 0x04, 0x03}, 4, false, 0);
			addInst({0x09, 0x01, 0x04, 0x04}, 4, false, 0);

			// EQL系
			// EQL EAX, ...
			addInst({0x0A, 0x00, 0x00, 0x00}, 4, true, 4);
			addInst({0x0A, 0x00, 0x00, 0x01}, 4, false, 0);
			addInst({0x0A, 0x00, 0x00, 0x02}, 4, false, 0);
			addInst({0x0A, 0x00, 0x00, 0x03}, 4, false, 0);
			addInst({0x0A, 0x00, 0x00, 0x04}, 4, false, 0);
			addInst({0x0A, 0x00, 0x00, 0x05}, 4, false, 0);

			// EQL EBX, ...
			addInst({0x0A, 0x00, 0x01, 0x00}, 4, true, 4);
			addInst({0x0A, 0x00, 0x01, 0x01}, 4, false, 0);
			addInst({0x0A, 0x00, 0x01, 0x02}, 4, false, 0);
			addInst({0x0A, 0x00, 0x01, 0x03}, 4, false, 0);
			addInst({0x0A, 0x00, 0x01, 0x04}, 4, false, 0);
			addInst({0x0A, 0x00, 0x01, 0x05}, 4, false, 0);
			addInst({0x0A, 0x00, 0x01, 0x06}, 4, true, 4);
			addInst({0x0A, 0x00, 0x01, 0x07}, 4, false, 0);
			addInst({0x0A, 0x00, 0x01, 0x08}, 4, false, 0);
			addInst({0x0A, 0x00, 0x01, 0x09}, 4, false, 0);
			addInst({0x0A, 0x00, 0x01, 0x0A}, 4, false, 0);

			// EQL ECX, ...
			addInst({0x0A, 0x00, 0x02, 0x00}, 4, true, 4);
			addInst({0x0A, 0x00, 0x02, 0x01}, 4, false, 0);
			addInst({0x0A, 0x00, 0x02, 0x02}, 4, false, 0);
			addInst({0x0A, 0x00, 0x02, 0x03}, 4, false, 0);
			addInst({0x0A, 0x00, 0x02, 0x04}, 4, false, 0);
			addInst({0x0A, 0x00, 0x02, 0x05}, 4, false, 0);

			// EQL EDX, ...
			addInst({0x0A, 0x00, 0x03, 0x00}, 4, true, 4);
			addInst({0x0A, 0x00, 0x03, 0x01}, 4, false, 0);
			addInst({0x0A, 0x00, 0x03, 0x02}, 4, false, 0);
			addInst({0x0A, 0x00, 0x03, 0x03}, 4, false, 0);
			addInst({0x0A, 0x00, 0x03, 0x04}, 4, false, 0);
			addInst({0x0A, 0x00, 0x03, 0x05}, 4, false, 0);

			// EQL EEX, ...
			addInst({0x0A, 0x00, 0x04, 0x00}, 4, true, 4);
			addInst({0x0A, 0x00, 0x04, 0x01}, 4, false, 0);
			addInst({0x0A, 0x00, 0x04, 0x02}, 4, false, 0);
			addInst({0x0A, 0x00, 0x04, 0x03}, 4, false, 0);
			addInst({0x0A, 0x00, 0x04, 0x04}, 4, false, 0);
			addInst({0x0A, 0x00, 0x04, 0x05}, 4, false, 0);

			// SML系
			// SML EAX, ...
			addInst({0x0A, 0x01, 0x00, 0x00}, 4, true, 4);
			addInst({0x0A, 0x01, 0x00, 0x01}, 4, false, 0);
			addInst({0x0A, 0x01, 0x00, 0x02}, 4, false, 0);
			addInst({0x0A, 0x01, 0x00, 0x03}, 4, false, 0);
			addInst({0x0A, 0x01, 0x00, 0x04}, 4, false, 0);

			// SML EBX, ...
			addInst({0x0A, 0x01, 0x01, 0x00}, 4, true, 4);
			addInst({0x0A, 0x01, 0x01, 0x01}, 4, false, 0);
			addInst({0x0A, 0x01, 0x01, 0x02}, 4, false, 0);
			addInst({0x0A, 0x01, 0x01, 0x03}, 4, false, 0);
			addInst({0x0A, 0x01, 0x01, 0x04}, 4, false, 0);
			addInst({0x0A, 0x01, 0x01, 0x05}, 4, false, 0);
			addInst({0x0A, 0x01, 0x01, 0x05}, 4, true, 4);
			addInst({0x0A, 0x01, 0x01, 0x06}, 4, false, 0);
			addInst({0x0A, 0x01, 0x01, 0x07}, 4, false, 0);
			addInst({0x0A, 0x01, 0x01, 0x08}, 4, false, 0);
			addInst({0x0A, 0x01, 0x01, 0x09}, 4, false, 0);

			// SML ECX, ...
			addInst({0x0A, 0x01, 0x02, 0x00}, 4, true, 4);
			addInst({0x0A, 0x01, 0x02, 0x01}, 4, false, 0);
			addInst({0x0A, 0x01, 0x02, 0x02}, 4, false, 0);
			addInst({0x0A, 0x01, 0x02, 0x03}, 4, false, 0);
			addInst({0x0A, 0x01, 0x02, 0x04}, 4, false, 0);

			// SML EDX, ...
			addInst({0x0A, 0x01, 0x03, 0x00}, 4, true, 4);
			addInst({0x0A, 0x01, 0x03, 0x01}, 4, false, 0);
			addInst({0x0A, 0x01, 0x03, 0x02}, 4, false, 0);
			addInst({0x0A, 0x01, 0x03, 0x03}, 4, false, 0);
			addInst({0x0A, 0x01, 0x03, 0x04}, 4, false, 0);

			// SML EEX, ...
			addInst({0x0A, 0x01, 0x04, 0x00}, 4, true, 4);
			addInst({0x0A, 0x01, 0x04, 0x01}, 4, false, 0);
			addInst({0x0A, 0x01, 0x04, 0x02}, 4, false, 0);
			addInst({0x0A, 0x01, 0x04, 0x03}, 4, false, 0);
			addInst({0x0A, 0x01, 0x04, 0x04}, 4, false, 0);

			// NEQ系
			// NEQ EAX, ...
			addInst({0x0A, 0x02, 0x00, 0x00}, 4, true, 4);
			addInst({0x0A, 0x02, 0x00, 0x01}, 4, false, 0);
			addInst({0x0A, 0x02, 0x00, 0x02}, 4, false, 0);
			addInst({0x0A, 0x02, 0x00, 0x03}, 4, false, 0);
			addInst({0x0A, 0x02, 0x00, 0x04}, 4, false, 0);
			addInst({0x0A, 0x02, 0x00, 0x05}, 4, false, 0);

			// NEQ EBX, ...
			addInst({0x0A, 0x02, 0x01, 0x00}, 4, true, 4);
			addInst({0x0A, 0x02, 0x01, 0x01}, 4, false, 0);
			addInst({0x0A, 0x02, 0x01, 0x02}, 4, false, 0);
			addInst({0x0A, 0x02, 0x01, 0x03}, 4, false, 0);
			addInst({0x0A, 0x02, 0x01, 0x04}, 4, false, 0);
			addInst({0x0A, 0x02, 0x01, 0x05}, 4, false, 0);
			addInst({0x0A, 0x02, 0x01, 0x06}, 4, true, 4);
			addInst({0x0A, 0x02, 0x01, 0x07}, 4, false, 0);
			addInst({0x0A, 0x02, 0x01, 0x08}, 4, false, 0);
			addInst({0x0A, 0x02, 0x01, 0x09}, 4, false, 0);
			addInst({0x0A, 0x02, 0x01, 0x0A}, 4, false, 0);

			// NEQ ECX, ...
			addInst({0x0A, 0x02, 0x02, 0x00}, 4, true, 4);
			addInst({0x0A, 0x02, 0x02, 0x01}, 4, false, 0);
			addInst({0x0A, 0x02, 0x02, 0x02}, 4, false, 0);
			addInst({0x0A, 0x02, 0x02, 0x03}, 4, false, 0);
			addInst({0x0A, 0x02, 0x02, 0x04}, 4, false, 0);
			addInst({0x0A, 0x02, 0x02, 0x05}, 4, false, 0);

			// NEQ EDX, ...
			addInst({0x0A, 0x02, 0x03, 0x00}, 4, true, 4);
			addInst({0x0A, 0x02, 0x03, 0x01}, 4, false, 0);
			addInst({0x0A, 0x02, 0x03, 0x02}, 4, false, 0);
			addInst({0x0A, 0x02, 0x03, 0x03}, 4, false, 0);
			addInst({0x0A, 0x02, 0x03, 0x04}, 4, false, 0);
			addInst({0x0A, 0x02, 0x03, 0x05}, 4, false, 0);

			// NEQ EEX, ...
			addInst({0x0A, 0x02, 0x04, 0x00}, 4, true, 4);
			addInst({0x0A, 0x02, 0x04, 0x01}, 4, false, 0);
			addInst({0x0A, 0x02, 0x04, 0x02}, 4, false, 0);
			addInst({0x0A, 0x02, 0x04, 0x03}, 4, false, 0);
			addInst({0x0A, 0x02, 0x04, 0x04}, 4, false, 0);
			addInst({0x0A, 0x02, 0x04, 0x05}, 4, false, 0);

			// JMP系
			// JMP...
			addInst({0x0B, 0x00, 0x00}, 3, true, 4);
			addInst({0x0B, 0x00, 0x01}, 3, false, 0);
			addInst({0x0B, 0x00, 0x02}, 3, false, 0);
			addInst({0x0B, 0x00, 0x03}, 3, false, 0);
			addInst({0x0B, 0x00, 0x04}, 3, false, 0);
			addInst({0x0B, 0x00, 0x05}, 3, false, 0);
			addInst({0x0B, 0x00, 0x06}, 3, false, 0);

			// JZ...
			addInst({0x0B, 0x01, 0x00}, 3, true, 4);
			addInst({0x0B, 0x01, 0x01}, 3, false, 0);
			addInst({0x0B, 0x01, 0x02}, 3, false, 0);
			addInst({0x0B, 0x01, 0x03}, 3, false, 0);
			addInst({0x0B, 0x01, 0x04}, 3, false, 0);
			addInst({0x0B, 0x01, 0x05}, 3, false, 0);
			addInst({0x0B, 0x01, 0x06}, 3, false, 0);

			// JS...
			addInst({0x0B, 0x02, 0x00}, 3, true, 4);
			addInst({0x0B, 0x02, 0x01}, 3, false, 0);
			addInst({0x0B, 0x02, 0x02}, 3, false, 0);
			addInst({0x0B, 0x02, 0x03}, 3, false, 0);
			addInst({0x0B, 0x02, 0x04}, 3, false, 0);
			addInst({0x0B, 0x02, 0x05}, 3, false, 0);
			addInst({0x0B, 0x02, 0x06}, 3, false, 0);

			// JC...
			addInst({0x0B, 0x03, 0x00}, 3, true, 4);
			addInst({0x0B, 0x03, 0x01}, 3, false, 0);
			addInst({0x0B, 0x03, 0x02}, 3, false, 0);
			addInst({0x0B, 0x03, 0x03}, 3, false, 0);
			addInst({0x0B, 0x03, 0x04}, 3, false, 0);
			addInst({0x0B, 0x03, 0x05}, 3, false, 0);
			addInst({0x0B, 0x03, 0x06}, 3, false, 0);

			// JNZ...
			addInst({0x0B, 0x04, 0x00}, 3, true, 4);
			addInst({0x0B, 0x04, 0x01}, 3, false, 0);
			addInst({0x0B, 0x04, 0x02}, 3, false, 0);
			addInst({0x0B, 0x04, 0x03}, 3, false, 0);
			addInst({0x0B, 0x04, 0x04}, 3, false, 0);
			addInst({0x0B, 0x04, 0x05}, 3, false, 0);
			addInst({0x0B, 0x04, 0x06}, 3, false, 0);

			// JNS...
			addInst({0x0B, 0x05, 0x00}, 3, true, 4);
			addInst({0x0B, 0x05, 0x01}, 3, false, 0);
			addInst({0x0B, 0x05, 0x02}, 3, false, 0);
			addInst({0x0B, 0x05, 0x03}, 3, false, 0);
			addInst({0x0B, 0x05, 0x04}, 3, false, 0);
			addInst({0x0B, 0x05, 0x05}, 3, false, 0);
			addInst({0x0B, 0x05, 0x06}, 3, false, 0);

			// JNC...
			addInst({0x0B, 0x06, 0x00}, 3, true, 4);
			addInst({0x0B, 0x06, 0x01}, 3, false, 0);
			addInst({0x0B, 0x06, 0x02}, 3, false, 0);
			addInst({0x0B, 0x06, 0x03}, 3, false, 0);
			addInst({0x0B, 0x06, 0x04}, 3, false, 0);
			addInst({0x0B, 0x06, 0x05}, 3, false, 0);
			addInst({0x0B, 0x06, 0x06}, 3, false, 0);

			// CALL系
			addInst({0x0C, 0x00}, 2, false, 0);
			addInst({0x0C, 0x01}, 2, false, 0);
			addInst({0x0C, 0x02}, 2, false, 0);
			addInst({0x0C, 0x03}, 2, false, 0);
			addInst({0x0C, 0x04}, 2, false, 0);

			// PUSH系
			addInst({0x0D, 0x00, 0x00}, 3, false, 0);
			addInst({0x0D, 0x00, 0x01}, 3, false, 0);
			addInst({0x0D, 0x00, 0x02}, 3, false, 0);
			addInst({0x0D, 0x00, 0x03}, 3, false, 0);
			addInst({0x0D, 0x00, 0x04}, 3, false, 0);
			addInst({0x0D, 0x00, 0x05}, 3, false, 0);
			addInst({0x0D, 0x00, 0x06}, 3, false, 0);

			// POP系
			addInst({0x0D, 0x01, 0x00}, 3, false, 0);
			addInst({0x0D, 0x01, 0x01}, 3, false, 0);
			addInst({0x0D, 0x01, 0x02}, 3, false, 0);
			addInst({0x0D, 0x01, 0x03}, 3, false, 0);
			addInst({0x0D, 0x01, 0x04}, 3, false, 0);
			addInst({0x0D, 0x01, 0x05}, 3, false, 0);
			addInst({0x0D, 0x01, 0x06}, 3, false, 0);

			// RET
			addInst({0x0E}, 1, false, 0);

			// HALT
			addInst({0x0F}, 1, false, 0);

			// IN
			addInst({0x10, 0x00}, 1, true, 1);

			// OUT
			addInst({0x10, 0x01}, 1, true, 1);

			// TRAP
			addInst({0xC0}, 1, false, 0);

			// SLD
			addInst({0xCF, 0x00}, 2, false, 0);
			addInst({0xCF, 0x01}, 2, false, 0);

			// DTRP
			addInst({0xFF}, 1, false, 0);

			return true;
		}

		bool decode(uint32_t addr, std::vector<uint8_t> &bytes, uint32_t maxL, InstInfo *out)
		{
			if(maxL < 1) return false;

			uint8_t currentByte;

			if(!mem->readByte(addr, &currentByte)) return false;

			bytes.push_back(currentByte);

			auto it = instTable.find(bytes);
			if(it != instTable.end())
			{
				*out = it->second;
				return true;
			}

			return decode(addr + 1, bytes, maxL - 1, out);
		}

		bool chkInst(uint8_t *oplist, std::vector<uint8_t> bytes, uint32_t len)
		{
			if(!(oplist[len - 1] ^ bytes[len - 1]) && 1 < len) return chkInst(oplist, bytes, len - 1);
			else if(!(oplist[len - 1] ^ bytes[len - 1]) && len < 2) return true;
			else return false;
		}
};

#endif /* inst.inc */
